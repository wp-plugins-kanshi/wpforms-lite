var WPFormsChallenge=window.WPFormsChallenge||{};WPFormsChallenge.core=window.WPFormsChallenge.core||((t,n,s)=>{var o={},l={},a={},r={initialSecondsLeft:60*WPFormsChallenge.admin.l10n.minutes_left,loadId:function(){return localStorage.getItem("wpformsChallengeTimerId")},saveId:function(e){localStorage.setItem("wpformsChallengeTimerId",e)},run:function(e){var t;if(5!==o.loadStep())return t=setInterval(function(){o.updateTimerUI(e),--e<0&&(r.saveSecondsLeft(0),clearInterval(t))},1e3),r.saveId(t),t},pause:function(){var e;0!==r.getSecondsLeft()&&5!==o.loadStep()&&(e=r.loadId(),clearInterval(e),e=s("#wpforms-challenge-timer").data("seconds-left"))&&r.saveSecondsLeft(e)},resume:function(){var e,t=r.getSecondsLeft();0!==t&&5!==o.loadStep()&&((e=r.loadId())&&clearInterval(e),r.run(t))},clear:function(){localStorage.removeItem("wpformsChallengeSecondsLeft"),localStorage.removeItem("wpformsChallengeTimerId"),localStorage.removeItem("wpformsChallengeTimerStatus"),s("#wpforms-challenge-timer").removeData("seconds-left")},getSecondsLeft:function(){var e=localStorage.getItem("wpformsChallengeSecondsLeft");return parseInt(e,10)||0},getSecondsSpent:function(e){return e=e||r.getSecondsLeft(),r.initialSecondsLeft-e},saveSecondsLeft:function(e){localStorage.setItem("wpformsChallengeSecondsLeft",e)},getMinutesFormatted:function(e){return e=e||r.getSecondsLeft(),Math.floor(e/60)},getSecondsFormatted:function(e){return(e=e||r.getSecondsLeft())%60},getFormatted:function(e){e=e||r.getSecondsLeft();var t=r.getMinutesFormatted(e),e=r.getSecondsFormatted(e);return t+(9<e?":":":0")+e}};return o={timer:r,init:function(){s(o.ready),s(n).on("load",function(){"function"==typeof s.ready.then?s.ready.then(o.load):o.load()})},ready:function(){o.setup(),o.events()},load:function(){"started"===wpforms_challenge_admin.option.status&&o.timer.run(o.timer.getSecondsLeft())},setup:function(){var e,t=o.timer.loadId();t&&(clearInterval(t),e=o.timer.getSecondsLeft()),t&&0!==o.loadStep()&&"inited"!==wpforms_challenge_admin.option.status||(e=o.timer.initialSecondsLeft),o.initElements(),o.refreshStep(),o.initListUI(null,!0),o.updateListUI(),o.updateTimerUI(e)},events:function(){s([n,t]).on("blur",o.pauseChallenge).on("focus",o.resumeChallenge).on("click",".wpforms-challenge-done-btn",o.resumeChallenge),a.$btnPause.on("click",o.pauseChallenge),a.$btnResume.on("click",o.resumeChallenge),a.$listSteps.on("click",".wpforms-challenge-item-current",o.refreshPage)},initElements:function(){a={$challenge:s(".wpforms-challenge"),$btnPause:s(".wpforms-challenge-pause"),$btnResume:s(".wpforms-challenge-resume"),$listSteps:s(".wpforms-challenge-list"),$listBlock:s(".wpforms-challenge-list-block"),$listBtnToggle:s(".wpforms-challenge-list-block .toggle-list"),$progressBar:s(".wpforms-challenge-bar"),$tooltipBtnDone:function(){return s(".wpforms-challenge-tooltip .wpforms-challenge-done-btn")}}},loadStep:function(){var e=localStorage.getItem("wpformsChallengeStep");return parseInt(e,10)||0},saveStep:function(e){return localStorage.setItem("wpformsChallengeStep",e),WPFormsChallenge.admin.saveChallengeOption({step:e})},refreshStep:function(){var e=a.$challenge.data("wpforms-challenge-saved-step"),e=parseInt(e,10)||0;o.loadStep()!==e&&o.saveStep(e)},stepCompleted:function(e){return o.updateListUI(e),o.updateTooltipUI(e),o.saveStep(e)},initTooltips(o,e,t){var n,l;void 0!==s.fn.tooltipster&&(n=s('<span class="wpforms-challenge-dot wpforms-challenge-dot-step'+o+'" data-wpforms-challenge-step="'+o+'">&nbsp;</span>'),l={content:s("#tooltip-content"+o),trigger:null,interactive:!0,animationDuration:0,delay:0,theme:["tooltipster-default","wpforms-challenge-tooltip"],side:["top"],distance:3,functionReady(e,t){s(t.tooltip).addClass("wpforms-challenge-tooltip-step"+o);t=s("body").hasClass("rtl");4===o||3===o?e.option("side",t?"left":"right"):1===o&&e.option("side",t?"right":"left"),e.reposition()}},"object"==typeof t&&null!==t&&s.extend(l,t),n.insertAfter(e).tooltipster(l))},updateTooltipUI:function(e){var l;e=e||o.loadStep(),l=e+1,s(".wpforms-challenge-dot").each(function(e,t){var o=s(t),n=o.data("wpforms-challenge-step");n<l&&o.addClass("wpforms-challenge-dot-completed"),l<n&&o.addClass("wpforms-challenge-dot-next"),n===l&&o.removeClass("wpforms-challenge-dot-completed wpforms-challenge-dot-next"),setTimeout(function(){o.is(":visible")&&n===l?o.tooltipster("open"):o.tooltipster("close")},0)})},initListUI:function(e,t){var o;e=e||wpforms_challenge_admin.option.status,-1<["started","paused"].indexOf(e)&&(a.$listBlock.find("p").hide(),a.$listBtnToggle.show(),a.$progressBar.show(),(o=a.$listBlock.find(".list-block-button.challenge-skip")).attr("title",o.data("cancel-title")).removeClass("challenge-skip").addClass("challenge-cancel")),t&&(s(n).height()<900&&""===wpforms_challenge_admin.option.window_closed||"1"===wpforms_challenge_admin.option.window_closed)&&(a.$listBlock.find("p").hide(),a.$listBtnToggle.trigger("click")),"paused"===e?(a.$challenge.addClass("paused"),a.$btnPause.hide(),a.$btnResume.show()):(setTimeout(function(){a.$btnPause.show()},0),a.$challenge.removeClass("paused"),a.$btnResume.hide())},updateListUI:function(e){e=e||o.loadStep(),a.$listSteps.find("li").slice(0,e).addClass("wpforms-challenge-item-completed").removeClass("wpforms-challenge-item-current"),a.$listSteps.find("li").eq(e).addClass("wpforms-challenge-item-current"),a.$progressBar.find("div").css("width",20*e+"%")},updateTimerUI:function(e){e&&!isNaN(e)&&"0"!==e||(e=0),o.timer.saveSecondsLeft(e),s("#wpforms-challenge-timer").text(o.timer.getFormatted(e)).data("seconds-left",e)},removeChallengeUI:function(){s(".wpforms-challenge-dot").remove(),a.$challenge.remove()},clearLocalStorage:function(){localStorage.removeItem("wpformsChallengeStep"),o.timer.clear()},pauseChallenge:function(e){"IFRAME"!==t.activeElement.tagName&&"started"===wpforms_challenge_admin.option.status&&(l.pauseEvent=e.type,o.pauseResumeChallenge("pause"))},resumeChallenge:function(e){if("paused"===wpforms_challenge_admin.option.status){if("focus"!==e.type||"blur"===l.pauseEvent)return l.resumeEvent=e.type,o.pauseResumeChallenge("resume");delete l.pauseEvent}},pauseResumeChallenge:function(e){o.timer[e="pause"===e?e:"resume"]();e={status:"pause"===e?"paused":"started",seconds_spent:o.timer.getSecondsSpent(),seconds_left:o.timer.getSecondsLeft()};return o.initListUI(e.status),WPFormsChallenge.admin.saveChallengeOption(e)},resumeChallengeAndExec:function(e,t){"function"!=typeof t&&(t=function(){}),"paused"===wpforms_challenge_admin.option.status&&"object"==typeof(e=o.resumeChallenge(e))&&"function"==typeof e.done?e.done(t):t()},async freezeChallenge(e=!0,t=""){e?(e=a.$listBlock.hasClass("closed"),a.$challenge.addClass("frozen").data("was-closed",e),a.$listBlock.addClass("closed").find("p").hide(),o.initFrozenTooltip(t.length?t:wpforms_challenge_admin.frozen_tooltip),o.pauseResumeChallenge("pause")):a.$challenge.hasClass("frozen")&&(a.$challenge.removeClass("frozen"),a.$progressBar.tooltipster("close"),o.pauseResumeChallenge("resume"),a.$challenge.data("was-closed")||a.$listBlock.removeClass("closed").find("p").show())},initFrozenTooltip(e){let t=a.$progressBar.data("tooltipster");t||(a.$progressBar.tooltipster({content:"",trigger:"manual",interactive:!1,animationDuration:100,maxWidth:230,delay:0,distance:36,side:["top"],theme:["tooltipster-default","wpforms-challenge-frozen-tooltip"],contentAsHTML:!0}),t=a.$progressBar.tooltipster("instance"),a.$progressBar.data("tooltipster",t)),a.$challenge.show(),t.content(e),t.open()},refreshPage(e){WPFormsUtils.triggerEvent(s(t),"wpformsChallengeCoreBeforeRefreshPage",e).isDefaultPrevented()||n.location.reload(!0)},isGutenberg:function(){return"undefined"!=typeof wp&&Object.prototype.hasOwnProperty.call(wp,"blocks")},triggerPageSave:function(){o.isGutenberg()?o.gutenbergPageSave():s("#post #publish").trigger("click")},gutenbergPageSave:function(){var n=s(".block-editor"),e=n.find(".editor-post-publish-button.editor-post-publish-button__button");(0<e.length?e:((e={targetNode:n.find(".edit-post-layout, .block-editor-editor-skeleton__publish > div")[0],config:{childList:!0,attributes:!0,subtree:!0},callback:function(e,t){var o=n.find(".editor-post-publish-button, .editor-post-publish-panel__header-publish-button .editor-post-publish-button__button");0<o.length&&(o.trigger("click"),t.disconnect())}}).observer=new MutationObserver(e.callback),e.observer.observe(e.targetNode,e.config),n.find(".edit-post-toggle-publish-panel__button, .editor-post-publish-panel__toggle.editor-post-publish-button__button"))).trigger("click")}}})(document,window,jQuery),WPFormsChallenge.core.init();